<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Clone</title>
    <style>
        /* Your styles here */
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="stats">
        <div id="hp"></div>
        <div id="score"></div>
        <div id="bulletAttack"></div>
        <div id="vulcanAttack"></div>
        <div id="maxHealth"></div>
    </div>
    <div id="inventory"></div>
    <div id="levelUpMenu" class="menu">
        <button class="optionButton"></button>
        <button class="optionButton"></button>
        <button class="optionButton"></button>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statsDiv = document.getElementById('stats');
        const inventoryDiv = document.getElementById('inventory');
        const levelUpMenu = document.getElementById('levelUpMenu');
        const optionButtons = document.querySelectorAll('.optionButton');

        class Entity {
            constructor(x, y, radius, speed, sprite) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.speed = speed;
                this.sprite = new Image();
                this.sprite.src = sprite;
            }

            draw(offsetX = 0, offsetY = 0) {
                ctx.drawImage(this.sprite, this.x - this.radius - offsetX, this.y - this.radius - offsetY, this.radius * 2, this.radius * 2);
            }
        }

        class Player extends Entity {
            constructor(x, y, radius, speed, sprite, hp) {
                super(x, y, radius, speed, sprite);
                this.hp = hp;
                this.maxHealth = hp;
                this.score = 0;
                this.bulletAttack = 1;
                this.vulcanAttack = 1;
                this.inventory = [];
                this.upgradeHistory = { bullet: 0, health: 0, vulcan: 0 };
                this.weapon = weapons[0]; // Starting weapon: Gun
                this.vulcanCooldown = 0;
            }

            move(keys) {
                if (keys['w']) this.y -= this.speed;
                if (keys['a']) this.x -= this.speed;
                if (keys['s']) this.y += this.speed;
                if (keys['d']) this.x += this.speed;

                // Ensure player stays within bounds
                this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                this.y = Math.max(this.radius, Math.min(canvas.height - this.radius, this.y));
            }

            shoot() {
                const now = Date.now();
                if (!this.lastShootTime || now - this.lastShootTime >= this.weapon.fireRate) {
                    this.lastShootTime = now;
                    const closestEnemy = this.findClosestEnemy();
                    if (closestEnemy) {
                        const angle = Math.atan2(closestEnemy.y - this.y, closestEnemy.x - this.x);
                        bullets.push(new Bullet(this.x, this.y, 5, 10, 'assets/bullet.png', angle));
                    }
                }
            }

            findClosestEnemy() {
                let closestEnemy = null;
                let closestDistance = Infinity;
                enemies.forEach(enemy => {
                    const distance = Math.hypot(enemy.x - this.x, enemy.y - this.y);
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestEnemy = enemy;
                    }
                });
                return closestEnemy;
            }

            addScore(points) {
                this.score += points;
                this.checkLevelUp();
                updateStats();
            }

            checkLevelUp() {
                const thresholds = [10, 50, 100, 200, 500, 1000];
                if (thresholds.includes(this.score)) {
                    showLevelUpMenu();
                }
            }

            addWeapon(weapon) {
                if (this.inventory.length < 6) {
                    this.inventory.push(weapon);
                }
                updateInventory();
            }

            enhanceWeapon(weaponName) {
                const weapon = this.inventory.find(item => item.name === weaponName);
                if (weapon) {
                    weapon.upgrade += 1;
                }
                updateInventory();
            }
        }

        class Enemy extends Entity {
            constructor(x, y, radius, speed, sprite, hp) {
                super(x, y, radius, speed, sprite);
                this.hp = hp;
                this.angle = Math.random() * Math.PI * 2;
            }

            update() {
                this.x += this.speed * Math.cos(this.angle);
                this.y += this.speed * Math.sin(this.angle);
                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.angle += Math.PI;
                }
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < player.radius + this.radius) {
                    player.hp -= 1;
                    if (player.hp <= 0) {
                        player.hp = 0;
                        alert('Game Over');
                        window.location.reload();
                    }
                }
            }
        }

        class Bullet extends Entity {
            constructor(x, y, radius, speed, sprite, angle) {
                super(x, y, radius, speed, sprite);
                this.angle = angle;
            }

            update() {
                this.x += this.speed * Math.cos(this.angle);
                this.y += this.speed * Math.sin(this.angle);

                enemies.forEach((enemy, index) => {
                    const dx = enemy.x - this.x;
                    const dy = enemy.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < enemy.radius + this.radius) {
                        enemy.hp -= player.bulletAttack;
                        if (enemy.hp <= 0) {
                            enemies.splice(index, 1);
                            player.addScore(10); // Adjust score points per enemy
                        }
                    }
                });
            }
        }

        const particles = [];
        const enemies = [];
        const bullets = [];
        let keys = {};
        let player;
        let offsetX = 0;
        let offsetY = 0;
        let animationFrameId;

        const weapons = [
            { name: 'Gun', fireRate: 500, image: 'https://opengameart.org/sites/default/files/gun.png', upgrade: 0 },
            { name: 'Vulcan', fireRate: 200, image: 'assets/vulcan.png', upgrade: 0 },
            { name: 'Sword', fireRate: 1000, image: 'https://opengameart.org/sites/default/files/sword.png', upgrade: 0 },
            { name: 'Rifle', fireRate: 600, image: 'https://opengameart.org/sites/default/files/rifle.png', upgrade: 0 },
            { name: 'Sniper', fireRate: 1200, image: 'https://opengameart.org/sites/default/files/sniper.png', upgrade: 0 },
            { name: 'Bomb', fireRate: 1500, image: 'https://opengameart.org/sites/default/files/bomb.png', upgrade: 0 },
            { name: 'Laser', fireRate: 800, image: 'https://opengameart.org/sites/default/files/laser.png', upgrade: 0 },
            { name: 'Armor', fireRate: 0, image: 'https://opengameart.org/sites/default/files/armor.png', upgrade: 0 },
            { name: 'Boots', fireRate: 0, image: 'https://opengameart.org/sites/default/files/boots.png', upgrade: 0 },
            { name: 'Helmet', fireRate: 0, image: 'https://opengameart.org/sites/default/files/helmet.png', upgrade: 0 },
        ];

        function showLevelUpMenu() {
            const availableWeapons = weapons.filter(weapon => !player.inventory.some(item => item.name === weapon.name));
            const randomOptions = [];
            while (randomOptions.length < 3 && availableWeapons.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableWeapons.length);
                const option = availableWeapons.splice(randomIndex, 1)[0];
                randomOptions.push(option);
            }

            randomOptions.forEach((option, index) => {
                optionButtons[index].textContent = option.name;
                optionButtons[index].onclick = () => {
                    if (player.inventory.some(item => item.name === option.name)) {
                        player.enhanceWeapon(option.name);
                    } else {
                        player.addWeapon(option);
                    }
                    levelUpMenu.style.display = 'none';
                };
            });

            levelUpMenu.style.display = 'block';
        }

        function updateStats() {
            statsDiv.innerHTML = `
                <div>HP: ${player.hp}/${player.maxHealth}</div>
                <div>Score: ${player.score}</div>
                <div>Bullet Attack: ${player.bulletAttack}</div>
                <div>Vulcan Attack: ${player.vulcanAttack}</div>
            `;
        }

        function updateInventory() {
            inventoryDiv.innerHTML = player.inventory.map(item => `<div>${item.name} (Level ${item.upgrade + 1})</div>`).join('');
        }

        function spawnEnemies() {
            const spawnInterval = 3000; // Adjust spawn rate as needed
            setInterval(() => {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const enemy = new Enemy(x, y, 15, 1, 'assets/enemy1.png', 10);
                enemies.push(enemy);
            }, spawnInterval);
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            player.move(keys);
            player.shoot();
            player.draw(offsetX, offsetY);

            bullets.forEach((bullet, index) => {
                bullet.update();
                bullet.draw(offsetX, offsetY);
            });

            enemies.forEach(enemy => {
                enemy.update();
                enemy.draw(offsetX, offsetY);
            });

            updateStats();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function init() {
            player = new Player(canvas.width / 2, canvas.height / 2, 20, 3, 'assets/mecha.png', 100);
            spawnEnemies();
            updateStats();
            gameLoop();
        }

        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        init();
    </script>
</body>
</html>
